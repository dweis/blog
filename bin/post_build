#!/bin/bash

if [ $# -ne 1 ]
then
  echo "You must pass in a tag name!"
  exit 65
fi

echo "Tagging \"$1\" before update..."
git tag $1

if [ $? -ne 0 ]
then
  echo "Failed to tag!"
  exit 1
fi

echo "Ensuring that we are on master..."
git checkout master

if [ $? -ne 0 ]
then
  echo "Failed to check out master!"
  exit 1
fi

echo "Updating..."
git pull
if [ $? -ne 0 ]
then
  echo "Failed to update master!"
  exit 1
fi

echo "Installing dependencies..."
npm install
if [ $? -ne 0 ]
then
  echo "Failed to install dependencies!"
  exit 1
fi

echo "Successfully updated to HEAD on master."

echo "Restarting blog..."

sudo service blog stop
sudo service blog start
if [ $? -ne 0 ]
then 
  echo "Failed to restart blog"
  exit 1
fi
